# Registry Credentials for gastown-operator CI
# Allows Kaniko and Skopeo to push images to container registries
#
# INSTRUCTIONS:
# 1. Do NOT commit this file with real credentials
# 2. Create secret manually (recommended)
#
# =============================================================================
# DUAL-REGISTRY SETUP (DPR + GHCR)
# =============================================================================
# The pipeline pushes to DPR (primary) and mirrors to GHCR (public).
# Both registries must be in the same secret.
#
# Step 1: Create separate secrets (temporary files)
#
#   kubectl create secret docker-registry dpr-creds \
#     --docker-server=dprusocplvjmp01.deepsky.lab:5000 \
#     --docker-username=${DPR_USER} \
#     --docker-password=${DPR_PASSWORD} \
#     -n olympus-ci --dry-run=client -o json > /tmp/dpr.json
#
#   kubectl create secret docker-registry ghcr-creds \
#     --docker-server=ghcr.io \
#     --docker-username=${GITHUB_USER} \
#     --docker-password=${GITHUB_TOKEN} \
#     -n olympus-ci --dry-run=client -o json > /tmp/ghcr.json
#
# Step 2: Merge into single secret with jq
#
#   jq -s '.[0] * {
#     "metadata": {"name": "registry-credentials"},
#     "data": {
#       ".dockerconfigjson": (
#         [.[].data[".dockerconfigjson"] | @base64d | fromjson] |
#         reduce .[] as $x ({}; .auths += $x.auths) |
#         @json | @base64
#       )
#     }
#   }' /tmp/dpr.json /tmp/ghcr.json | kubectl apply -n olympus-ci -f -
#
# Step 3: Cleanup temp files
#
#   rm /tmp/dpr.json /tmp/ghcr.json
#
# =============================================================================
# SINGLE REGISTRY EXAMPLES
# =============================================================================
#
#   # GitHub Container Registry only
#   kubectl create secret docker-registry registry-credentials \
#     --docker-server=ghcr.io \
#     --docker-username=${GITHUB_USER} \
#     --docker-password=${GITHUB_TOKEN} \
#     -n olympus-ci
#
#   # Docker Hub
#   kubectl create secret docker-registry registry-credentials \
#     --docker-server=docker.io \
#     --docker-username=${DOCKER_USER} \
#     --docker-password=${DOCKER_PASSWORD} \
#     -n olympus-ci
#
#   # Quay.io
#   kubectl create secret docker-registry registry-credentials \
#     --docker-server=quay.io \
#     --docker-username=${QUAY_USER} \
#     --docker-password=${QUAY_PASSWORD} \
#     -n olympus-ci
#
# OR use this template with base64-encoded credentials:
#    echo -n '{"auths":{"<REGISTRY>":{"username":"USER","password":"PASS","auth":"BASE64"}}}' | base64
---
apiVersion: v1
kind: Secret
metadata:
  name: registry-credentials
  # CUSTOMIZE: Set to your CI namespace
  labels:
    app.kubernetes.io/name: gastown-operator
    app.kubernetes.io/component: ci
type: kubernetes.io/dockerconfigjson
data:
  # PLACEHOLDER - Replace with actual base64-encoded dockerconfig
  # Generate with: kubectl create secret docker-registry ... --dry-run=client -o yaml
  .dockerconfigjson: REPLACE_WITH_BASE64_ENCODED_DOCKERCONFIG
